--- a/packages/opencode/src/cli/cmd/tui/thread.ts
+++ b/packages/opencode/src/cli/cmd/tui/thread.ts
@@ -68,11 +68,6 @@
     // Resolve relative paths against PWD to preserve behavior when using --cwd flag
     const baseCwd = process.env.PWD ?? process.cwd()
     const cwd = args.project ? path.resolve(baseCwd, args.project) : process.cwd()
-    let workerPath: string | URL = new URL("./worker.ts", import.meta.url)
-
-    if (typeof OPENCODE_WORKER_PATH !== "undefined") {
-      workerPath = OPENCODE_WORKER_PATH
-    }
     try {
       process.chdir(cwd)
     } catch (e) {
@@ -107,24 +102,9 @@
         return undefined
       })()
 
-      const worker = new Worker(workerPath, {
-        env: Object.fromEntries(
-          Object.entries(process.env).filter(
-            (entry): entry is [string, string] => entry[1] !== undefined,
-          ),
-        ),
-      })
-      worker.onerror = console.error
-      const client = Rpc.client<typeof rpc>(worker)
-      process.on("uncaughtException", (e) => {
-        console.error(e)
-      })
-      process.on("unhandledRejection", (e) => {
-        console.error(e)
-      })
-      const server = await client.call("server", {
-        port: args.port,
-        hostname: args.hostname,
+      const server = Server.listen({
+        port: args.port ?? 0,
+        hostname: args.hostname ?? "127.0.0.1",
       })
       await tui({
         url: server.url,
@@ -133,7 +113,8 @@
         agent: args.agent,
         prompt,
         onExit: async () => {
-          await client.call("shutdown", undefined)
+          await import("@/global").then((mod) => mod.Global.disposeAll())
+          server.stop()
         },
       })
     })
